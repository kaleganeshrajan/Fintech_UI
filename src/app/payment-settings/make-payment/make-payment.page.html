<ion-content padding="true" class="background-white">
  <form [formGroup]="formGroup" class="panel-body">
    <ion-grid class="ion-no-padding" >
      <ion-row>
        <ion-col size-xs="12" size-sm="12" size-md="12" size-lg="12" class="ion-no-padding">
          <ion-item lines="none" class="position-left" color="transparent">
            <ion-back-button defaultHref="/tabs"></ion-back-button>
            <ion-text class="pageTitle">Make Payment</ion-text>
          </ion-item>
        </ion-col>
      </ion-row>
    </ion-grid>
<!-- Search Box -->
    <ion-grid *ngIf="isSelectInv">
      <ion-row>
        <ion-col size-xs="12" size-sm="12" size-md="6" size-lg="2" class="ion-padding">
          <ion-item>
            <ion-label position="floating">Select Search Filter</ion-label>
            <ion-select value="formGroup['SearchFilterType']" formControlName="SearchFilterType" interface="popover" class="pb-34">
              <ion-select-option *ngFor="let item of SearchFilterList" value="{{item.Code}}">
                {{ item.Name }}
              </ion-select-option>
            </ion-select>
          </ion-item>
        </ion-col>
        <ion-col size-xs="12" size-sm="12" size-md="6" size-lg="2" class="ion-padding">
          <ion-item>
            <ion-label position="floating">Search Text</ion-label>
            <ion-input [value]="formGroup.SearchText" formControlName="SearchText" type="text"
              class="input-padding-btm">
            </ion-input>
          </ion-item>
        </ion-col>
        <ion-col size-xs="12" size-sm="12" size-md="6" size-lg="2" class="ion-padding">
          <ion-item>
            <ion-label position="floating">Select Date Filter</ion-label>
            <ion-select value="formGroup['DateFilterType']" formControlName="DateFilterType" interface="popover" class="dropdown-padding-btm">
              <ion-select-option *ngFor="let item of DateFilterList" value="{{item.Code}}">
                {{ item.Name }}
              </ion-select-option>
            </ion-select>
          </ion-item>
        </ion-col>
        <ion-col size-xs="12" size-sm="12" size-md="6" size-lg="2" class="ion-no-padding mt-13">
          <ion-item>
            <ion-label position="floating">From Date</ion-label>
            <ion-datetime [value]="formGroup.FromDate" formControlName="FromDate" display-timezone="ist"></ion-datetime>
          </ion-item>
        </ion-col>
        <ion-col size-xs="12" size-sm="12" size-md="6" size-lg="1" class="ion-no-padding mt-13">
          <ion-item>
            <ion-label position="floating">To Date</ion-label>
            <ion-datetime [value]="formGroup.ToDate" formControlName="ToDate" display-timezone="ist"></ion-datetime>
          </ion-item>
        </ion-col>
        <ion-col size-xs="12" size-sm="12" size-md="6" size-lg="3" class="ion-padding">
          <ion-button (click)="searchInvoice()" class="">
            <ion-icon slot="start" name="search"></ion-icon>
            <small>Search</small>
          </ion-button>
          <ion-button (click)="saveUpdateSetting()" class="">
            <ion-icon slot="start" name="download"></ion-icon>
            <small>Download Report</small>
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>

    <!-- All Invoices -->
    <ion-grid class="form-card margin-large-top" *ngIf="isSelectInv && InvoiceList?.length > 0">
      <ion-row class="bg-theme-blue">
        <ion-col size-xs="12" size-sm="12" size-md="4" size-lg="4" class="ion-padding">
          Total Invoices:
        </ion-col>
        <ion-col size-xs="12" size-sm="12" size-md="4" size-lg="4" class="ion-padding">
          Invoice Amount:
        </ion-col>
        <ion-col size-xs="12" size-sm="12" size-md="4" size-lg="4" class="ion-padding">
          Balance Amount:
        </ion-col>
      </ion-row>
      <ion-grid class="ion-margin">
        <ion-row>
          <table class="table">
            <thead>
              <tr>
                <th>
                  Select
                </th>
                <th>Invoice Details</th>
                <th>Invoice Date</th>
                <th>Order No</th>
                <th>Amount</th>
                <th>LR Date</th>
                <th>Due Date</th>
              </tr>
            </thead>
            <tbody *ngFor="let item of InvoiceList">
              <tr>  
                <td>
                  <ion-checkbox [checked]="item.IsScheduled"
                    (ionChange)="updateInvoiceList(item.ID, 'IsScheduled', $event.target.checked)"></ion-checkbox>
                </td>
                <td>{{item.InvoiceDetails}}</td>
                <td>{{parseDate(item.InvoiceDate)}}</td>
                <td>{{item.OrderNo}}</td>
                <td>{{item.Amount}}</td>
                <td>{{parseDate(item.LRDate)}}</td>
                <td class="ion-no-padding">
                  <ion-item>
                    <ion-datetime [value]="item.DueDate"
                      (ionChange)="updateInvoiceList(item.ID, 'DueDate', $event.target.value)" display-format="YYYY-MM-DD"  placeholder="Due Date"
                      display-timezone="ist"></ion-datetime>
                  </ion-item>
                </td>
              </tr>
            </tbody>
          </table>
        </ion-row>
      </ion-grid>
    </ion-grid>
    <!-- Selected Invoices -->
    <ion-grid class="form-card margin-large-top" *ngIf="isScheduleInv || isOTPSent">
      <ion-row class="padding-mini">
        <table class="table">
          <thead>
            <tr>
              <th>Invoice Details</th>
              <th>Invoice Date</th>
              <th>Order No</th>
              <th>Amount</th>
              <th>LR Date</th>
              <th>Due Date</th>
            </tr>
          </thead>
          <tbody *ngFor="let item of ScheduleInvList">
            <tr>
              <td>Inv no.{{item.InvoiceDetails}}</td>
              <td>{{parseDate(item.InvoiceDate)}}</td>
              <td>{{item.OrderNo}}</td>
              <td>{{item.Amount}}</td>
              <td>{{parseDate(item.LRDate)}}</td>
              <td>{{parseDate(item.DueDate)}}</td>
            </tr>
          </tbody>
        </table>
      </ion-row>
    </ion-grid>
    <!-- Payment Schedule Success -->
    <ion-grid class="form-card margin-large-top" *ngIf="scheduleSuccess">
      <ion-row class="padding-mini">
        <ion-col size-xs="12" size-sm="12" size-md="12" size-lg="12" class="ion-padding">
          <ion-row>
            <ion-col size-xs="3" size-sm="3" size-md="3" size-lg="1" class="ion-padding">
              <span>
                <ion-icon class="success-icon" slot="start" name="checkmark-circle-outline"></ion-icon>
              </span>
            </ion-col>
            <ion-col size-xs="9" size-sm="9" size-md="9" size-lg="10" class="ion-padding">
              <span class="success-text">
                Payment Scheduled!
              </span>
              <br>
              <span>Your payment has been scheduled! Details of the transaction are provided below.</span>
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col size-lg="1"></ion-col>
        <ion-col size-xs="6" size-sm="6" size-md="4" size-lg="2"><b>Amount:</b></ion-col>
        <ion-col size-xs="6" size-sm="6" size-md="4" size-lg="2">â‚¹12000/-</ion-col>
      </ion-row>
      <ion-row>
        <ion-col size-lg="1"></ion-col>
        <ion-col size-xs="6" size-sm="6" size-md="4" size-lg="2"><b>Receipt ID:</b></ion-col>
        <ion-col size-xs="6" size-sm="6" size-md="4" size-lg="2">248422675</ion-col>
      </ion-row>
      <ion-row>
        <ion-col size-lg="1"></ion-col>
        <ion-col size-xs="6" size-sm="6" size-md="4" size-lg="2"><b>Transaction Time:</b></ion-col>
        <ion-col size-xs="6" size-sm="6" size-md="4" size-lg="2">2021-11-01</ion-col>
      </ion-row>
      <ion-row>
        <ion-col size-lg="1"></ion-col>
        <ion-col size-xs="6" size-sm="6" size-md="4" size-lg="2"><b>Payment Mode:</b></ion-col>
        <ion-col size-xs="6" size-sm="6" size-md="4" size-lg="2">E-Cheque</ion-col>
      </ion-row>
    </ion-grid>
    <!-- Schedule Payment Button -->
    <ion-grid class="margin-small-top margin-small-left" *ngIf="isSelectInv && InvoiceList?.length > 0">
      <ion-row class="padding-mini">
        <ion-col size-xs="12" size-sm="12" size-md="12" size-lg="3">
          <ion-button (click)="schedulePayment()" class="full-width">
            <ion-icon slot="start" name="calendar"></ion-icon>
            <small>Schedule Payment</small>
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
    <!-- Send OTP Button -->
    <ion-grid class="margin-small-top margin-small-left" *ngIf="isScheduleInv && !isOTPSent">
      <ion-row class="padding-mini">
        <ion-col size-xs="12" size-sm="12" size-md="12" size-lg="3">
          <ion-button (click)="sendOtp()" class="full-width">
            <ion-icon slot="start" name="phone-portrait"></ion-icon>
            <small>Send OTP for Verification</small>
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
    <!-- Verify OTP Button -->
    <ion-grid class="margin-small-top margin-small-left" *ngIf="isOTPSent">
      <ion-row class="padding-mini">
        <ion-col size-xs="12" size-sm="12" size-md="12" size-lg="2">
          <ion-input class="otp-input" [ngModelOptions]="{standalone: true}" type="number" #otp1 required="true" maxLength="1" [(ngModel)]="OTP[0]"
            (keyup)="otpController($event,otp2,'')">
          </ion-input>
          <ion-input class="otp-input" [ngModelOptions]="{standalone: true}" type="number" #otp2 required="true" maxLength="1" [(ngModel)]="OTP[1]"
            (keyup)="otpController($event,otp3,otp1)">
          </ion-input>
          <ion-input class="otp-input" [ngModelOptions]="{standalone: true}" type="number" #otp3 required="true" maxLength="1" [(ngModel)]="OTP[2]"
            (keyup)="otpController($event,otp4,otp2)">
          </ion-input>
          <ion-input class="otp-input" [ngModelOptions]="{standalone: true}" type="number" #otp4 required="true" maxLength="1" [(ngModel)]="OTP[3]"
            (keyup)="otpController($event,otp5,otp3)">
          </ion-input>

          <!-- <ion-input class="otp-input" type="number" #otp5 required="true" maxLength="1" [(ngModel)]="OTP[4]"
            (keyup)="otpController($event,otp6,otp4)">
          </ion-input>

          <ion-input class="otp-input" type="number" #otp6 required="true" maxLength="1" [(ngModel)]="OTP[5]"
            (keyup)="otpController($event,'',otp5)">
          </ion-input> -->
        </ion-col>
        <ion-col size-xs="12" size-sm="12" size-md="12" size-lg="3">
          <ion-button (click)="verifyandconfirm()" class="full-width">
            <ion-icon slot="start" name="checkmark"></ion-icon>
            <small>Verify and Confirm</small>
          </ion-button>
          <small>Don't receive OTP? <span class="resend-otp">RESEND OTP.</span></small>
        </ion-col>
      </ion-row>
    </ion-grid>

  </form>
</ion-content>